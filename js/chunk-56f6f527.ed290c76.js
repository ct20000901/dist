(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-56f6f527"],{"2cac":function(e,t,i){"use strict";var r=i("32c8"),a=i.n(r);a.a},"32c8":function(e,t,i){},"4de4":function(e,t,i){"use strict";var r=i("23e7"),a=i("b727").filter,o=i("1dde"),l=i("ae40"),s=o("filter"),c=l("filter");r({target:"Array",proto:!0,forced:!s||!c},{filter:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}})},"7db0":function(e,t,i){"use strict";var r=i("23e7"),a=i("b727").find,o=i("44d2"),l=i("ae40"),s="find",c=!0,n=l(s);s in[]&&Array(1)[s]((function(){c=!1})),r({target:"Array",proto:!0,forced:c||!n},{find:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}}),o(s)},ee61:function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"editCommodity-wrapper"},[i("card",{attrs:{title:"新增商品"}},[i("el-button",{staticClass:"card-btn",attrs:{size:"small",type:"primary"},on:{click:function(t){return e.$router.back(-1)}}},[e._v("返回")]),i("el-form",{ref:"form",staticClass:"commodity-form",attrs:{model:e.product,"label-width":"100px",rules:e.rule}},[i("el-form-item",{attrs:{label:"商品名称",prop:"pname"}},[i("el-input",{staticStyle:{width:"300px"},model:{value:e.product.pName,callback:function(t){e.$set(e.product,"pName",t)},expression:"product.pName"}})],1),i("el-form-item",{attrs:{label:"商品价格",prop:"price"}},[i("el-input-number",{attrs:{step:.1,precision:1},model:{value:e.product.price,callback:function(t){e.$set(e.product,"price",t)},expression:"product.price"}})],1),i("el-form-item",{attrs:{label:"商品详情图",prop:"pic"}},[i("el-upload",{ref:"upload",class:{disabled:e.uploadDisabled},attrs:{action:e.imgUploadUrl,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"on-success":e.handleSuccesspic,"file-list":e.picFile,"list-type":"picture-card",limit:1,"on-change":e.onChange}},[i("i",{staticClass:"el-icon-plus"})])],1),i("el-form-item",{attrs:{label:"商品类型",prop:"tid"}},[i("el-select",{staticClass:"select-type",attrs:{placeholder:"请选择"},on:{change:e.typeChange},model:{value:e.tid,callback:function(t){e.tid=t},expression:"tid"}},e._l(e.typelist,(function(e){return i("el-option",{key:e.tid,attrs:{label:e.tname,value:e.tid}})})),1)],1),i("el-form-item",{attrs:{label:"适用年龄",prop:"age"}},[i("el-input-number",{attrs:{step:1},model:{value:e.downAge,callback:function(t){e.downAge=t},expression:"downAge"}}),i("el-select",{staticClass:"select-data",attrs:{placeholder:"请选择"},model:{value:e.ageType[0],callback:function(t){e.$set(e.ageType,0,t)},expression:"ageType[0]"}},[i("el-option",{attrs:{label:"天",value:0}}),i("el-option",{attrs:{label:"月",value:1}}),i("el-option",{attrs:{label:"年",value:2}})],1),e._v(" — "),i("el-input-number",{attrs:{step:1},model:{value:e.upAge,callback:function(t){e.upAge=t},expression:"upAge"}}),i("el-select",{staticClass:"select-data",attrs:{placeholder:"请选择"},model:{value:e.ageType[1],callback:function(t){e.$set(e.ageType,1,t)},expression:"ageType[1]"}},[i("el-option",{attrs:{label:"天",value:0}}),i("el-option",{attrs:{label:"月",value:1}}),i("el-option",{attrs:{label:"年",value:2}})],1)],1),i("el-form-item",{attrs:{label:"图片描述",prop:"pics"}},[i("el-upload",{ref:"upload",attrs:{action:e.imgUploadUrl,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"on-success":e.handleSuccesspics,"file-list":e.picsList,"list-type":"picture-card",multiple:!0}},[i("i",{staticClass:"el-icon-plus"})])],1),i("el-form-item",{attrs:{label:"文字描述",prop:"intro"}},[i("el-input",{staticStyle:{width:"500px"},attrs:{type:"textarea"},model:{value:e.product.intro,callback:function(t){e.$set(e.product,"intro",t)},expression:"product.intro"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确定")])],1)],1)],1),i("el-dialog",{attrs:{visible:e.imgPreview},on:{"update:visible":function(t){e.imgPreview=t}}},[i("img",{attrs:{width:"100%",src:e.imgPreviewUrl,alt:""}})])],1)},a=[],o=(i("4de4"),i("7db0"),i("fb6a"),i("a9e3"),i("b85c")),l=i("ff86"),s={components:{card:l["a"]},data:function(){var e=this,t=function(t,i,r){e.product.pName?r():r(new Error("请填写商品名称"))},i=function(t,i,r){e.tid?r():r(new Error("请选择商品类型"))},r=function(t,i,r){e.timePackage(),e.product.upAge<e.product.downAge?r(new Error("适用年龄格式错误")):r()};return{imgUploadUrl:"https://www.ymxjkx.com/api/back/product/uploadImage",imgPreviewUrl:"",imgPreview:!1,picFile:[],picsList:[],tid:"",product:{pName:"",price:0,downAge:0,upAge:0,type:{tid:0,tname:""},pic:"",picUrls:[],intro:""},ageType:[0,0],downAge:0,upAge:0,rule:{pname:[{validator:t,trigger:"blur"}],tid:[{validator:i,trigger:"change"}],age:[{validator:r,trigger:"blur"},{validator:r,trigger:"change"}]},uploadDisabled:!1}},computed:{typelist:function(){return this.$store.state.typelist}},methods:{onSubmit:function(){var e=this;this.$refs.form.validate((function(t){if(!t)return!1;e.timePackage();var i=e.$route.query.pid?"/back/product/updateProduct":"/back/product/addProduct";e.$axios({url:i,method:"post",transformRequest:[function(e){return JSON.stringify(e)}],data:e.product,headers:{"Content-Type":"application/json"}}).then((function(t){200==t.data.code?(e.$message({type:"success",message:e.$route.query.pid?"修改商品信息成功":"添加商品成功"}),e.$router.back(-1)):e.$message({type:"error",message:"添加商品失败"})}))}))},onChange:function(e,t){this.uploadDisabled=!!t.length,console.log(t)},timePackage:function(){var e=[1,30,365];this.product.downAge=this.downAge*e[this.ageType[0]],this.product.upAge=this.upAge*e[this.ageType[1]]},typeChange:function(e){var t=Number(e);this.product.type.tid=t,this.product.type.tname=this.typelist.find((function(e){return e.tid==t})).tname},handleRemove:function(e,t){var i=this;this.$axios({url:"/back/product/deleteImage",params:{fileUrl:e.url}}).then((function(t){i.product.pic===e.url.slice(7)&&(i.product.pic=""),i.uploadDisabled=!!i.product.pic.length,i.product.picUrls=i.product.picUrls.filter((function(t){return t.purl!==e.url.slice(7)})),200==t.data.code?i.$message({type:"success",message:"移除成功"}):i.$message({type:"error",message:"移除失败"})}))},handlePreview:function(e){this.imgPreviewUrl=e.url,this.imgPreview=!0},handleSuccesspic:function(e,t,i){this.product.pic=e.data},handleSuccesspics:function(e,t,i){this.product.picUrls.push({purl:e.data})},ageConvert:function(e,t){return e/365>0&&e%365==0?(this.ageType[t]=2,e/365):e/365>0&&e%365!==0?e%30==0?(this.ageType[t]=1,e/30):(this.ageType[t]=0,e):e>=30&&e<365&&e%30==0?(this.ageType[t]=1,e/30):(this.ageType[t]=0,e)}},created:function(){if(this.$route.query.pid){this.product=this.$store.state.product,this.picFile=this.product.pic?[{name:"0",url:"http://"+this.product.pic}]:[],this.uploadDisabled=this.picFile.length;var e,t=Object(o["a"])(this.product.picUrls);try{for(t.s();!(e=t.n()).done;){var i=e.value;this.picsList.push({name:i.pid,url:"http://"+i.purl})}}catch(r){t.e(r)}finally{t.f()}this.tid=this.product.type.tid,this.downAge=this.ageConvert(this.product.downAge,0),this.upAge=this.ageConvert(this.product.upAge,1)}}},c=s,n=(i("2cac"),i("2877")),p=Object(n["a"])(c,r,a,!1,null,null,null);t["default"]=p.exports}}]);
//# sourceMappingURL=chunk-56f6f527.ed290c76.js.map